<!doctype html>
<style>
body { font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; margin: 20px; }
table { border-collapse: collapse; width: 520px; }
td, th { border: 1px solid #ddd; padding: 6px 8px; }
th { background: #f5f5f5; text-align: left; }
.price { font-variant-numeric: tabular-nums; text-align: right; }
.row { transition: background-color .25s ease; }
.flash { background-color: #fff2b3; }
</style>
</head>
<body>
<h2>Yahoo Finance Live (via polling)</h2>
<form id="form">
<label>Symbols (comma-separated):</label>
<input id="symbols" size="60" value="^GSPC,^NDX,^DJI,^GDAXI,^FCHI,^FTSE,^N225" />
<label>Interval (sec):</label>
<input id="interval" type="number" min="1" value="5" style="width:60px" />
<button type="submit">Subscribe</button>
</form>


<table id="tbl">
<thead>
<tr><th>Symbol</th><th>Price</th><th>Currency</th><th>Timestamp</th></tr>
</thead>
<tbody></tbody>
</table>


<script>
const ws = new WebSocket("wss://yahoo-live.onrender.com/ws");
const tbody = document.querySelector('#tbl tbody');
const rows = new Map();


function ensureRow(sym) {
if (rows.has(sym)) return rows.get(sym);
const tr = document.createElement('tr');
tr.className = 'row';
tr.innerHTML = `<td>${sym}</td><td class="price"></td><td></td><td></td>`;
tbody.appendChild(tr);
rows.set(sym, tr);
return tr;
}


function flash(tr) {
tr.classList.add('flash');
setTimeout(() => tr.classList.remove('flash'), 250);
}


ws.addEventListener('open', () => {
console.log('WebSocket open');
});


ws.addEventListener('message', (evt) => {
const msg = JSON.parse(evt.data);
if (msg.type === 'quotes') {
for (const q of msg.data) {
const tr = ensureRow(q.symbol);
const tds = tr.querySelectorAll('td');
const prev = tds[1].textContent;
const p = (q.price != null) ? q.price.toFixed(4) : '';
tds[1].textContent = p;
tds[2].textContent = q.currency || '';
tds[3].textContent = q.timestamp ? new Date(q.timestamp * 1000).toLocaleString() : '';
if (prev !== p) flash(tr);
}
}
});


document.getElementById('form').addEventListener('submit', (e) => {
e.preventDefault();
const symbols = document.getElementById('symbols').value.split(',').map(s => s.trim()).filter(Boolean);
const interval = parseFloat(document.getElementById('interval').value || '5');
ws.send(JSON.stringify({ type: 'subscribe', symbols, interval }));
});
</script>
</body>
</html>